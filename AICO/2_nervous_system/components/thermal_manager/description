PID + predictive controller for fan PWM and power caps